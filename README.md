# 交互式多曲线功率–效率绘图工具

> 单文件纯前端工具，专为多组 DC 输入功率与效率数据的可视化、对比与导出而设计

## 📋 项目简介

这是一款基于 Web 的数据可视化工具，采用纯前端架构（HTML/CSS/JavaScript），使用 Chart.js v4 图表库（通过 CDN 引入），无需后端支持、无需安装依赖，**打开即用**。

### 适用场景

- 电力电子设备（如 DC-DC 转换器、逆变器）的功率-效率特性分析
- 多组实验数据的可视化对比
- 技术报告、论文中的图表快速生成与导出
- 教学演示与数据分析

### 核心特性

- ✅ **单文件架构**：所有代码内联于 `index.html`，便于分享与部署
- ✅ **零依赖安装**：所有外部库通过 CDN 加载，下载即可使用
- ✅ **离线友好**：支持 localStorage 自动保存，数据不丢失
- ✅ **响应式设计**：适配桌面端与平板设备

---

## 🚀 快速开始

### 运行方式

1. **本地使用**：直接双击 `index.html` 文件，或将其拖拽至浏览器窗口
2. **在线访问**：部署到 Web 服务器或 GitHub Pages（见[部署章节](#部署与分享)）

### 推荐浏览器

- Google Chrome（最新版）
- Microsoft Edge（最新版）
- Mozilla Firefox（最新版）

### 首次使用

打开工具后，曲线 1 已自动加载示例数据，您可以：

1. 直接查看图表交互效果（鼠标悬停查看数值）
2. 展开"曲线 1"面板，尝试添加/删除数据点
3. 调整"全局设置"中的标题、轴范围等参数
4. 点击"导出 PNG"按钮保存图表

---

## 📖 主要功能

### 1. 多曲线管理

- **支持最多 5 条曲线**，每条曲线独立配置：
  - 曲线名称（如"电压 1"、"负载测试 A"等）
  - 曲线颜色（默认提供 5 种配色，可自定义）
  - 显示/隐藏开关（便于对比分析）
  - 独立的数据输入与管理区域

- **折叠面板**：支持单独展开/折叠每条曲线的配置面板，也可一键全部折叠/展开

### 2. 数据输入

#### 批量粘贴解析

支持从 Excel、文本文件或其他工具直接粘贴数据，自动识别以下分隔符：

- 空格：`10 95.5`
- 制表符（Tab）：`10	95.5`
- 逗号：`10,95.5`

**示例输入**：

```
0.5 92.3
1.0 94.8
1.5 96.2
2.0 97.1
2.5 97.8
3.0 97.5
```

**解析规则**：

- 每行必须包含两个数值（功率 效率）
- 空行和注释行（如以 `#` 开头）将被自动忽略
- 支持小数点（`.`）格式
- 数据单位：功率默认为 kW，效率默认为 %

#### 逐点添加

在"逐点添加"区域手动输入单个数据点：

1. 输入功率值（kW）
2. 输入效率值（%）
3. 点击"➕ 添加点"按钮

#### 数据表格管理

- **查看**：数据点自动显示在表格中，支持滚动查看
- **删除**：点击表格行右侧的"❌"按钮删除单个数据点
- **清空**：点击"清空数据"按钮清除当前曲线的所有数据点

### 3. 图表设置

#### 基础配置

- **图表主标题**：默认为"功率-效率特性曲线"
- **X 轴标题**：默认为"DC输入功率 (kW)"
- **Y 轴标题**：默认为"效率 (%)"
- **坐标轴范围**：
  - X 轴最小值 / 最大值（留空为自动缩放）
  - Y 轴最小值 / 最大值（默认 0–100）

#### 视觉效果

- ☑ **平滑曲线**：启用贝塞尔曲线插值，使折线更流畅
- ☑ **区域填充**：在曲线下方填充半透明颜色
- ☑ **显示数据点**：在曲线上标记每个实际数据点

#### 效率参考线

输入目标效率值（如 `97.5`），在图表上绘制一条水平虚线，便于快速评估性能指标。

### 4. 最大效率点高亮

#### 自动识别

工具会自动为每条曲线计算最大效率点：

- 若有多个点效率值相同，则选择**功率最小**的点
- 高亮标记在图表上（与曲线同色、无边框）

#### 样式配置

- **标记形状**：圆形 / 三角形 / 矩形 / 旋转矩形 / 星形 / 十字
- **标记大小**：3–10 像素可调（默认 6px）
- **显示控制**：可通过"标记最大效率点"复选框关闭

#### 多视图联动

- **图表高亮**：最大效率点在曲线上以彩色标记显示
- **表格高亮**：对应数据点的表格行背景色高亮
- **汇总表**：独立"最大效率汇总"面板，集中展示所有曲线的最大效率值与对应功率

### 5. 字体大小配置

展开"字体大小设置"折叠面板，可分别调整：

- **图表主标题**（8–32px，默认 18px）
- **轴标题**（8–24px，默认 14px）
- **轴刻度值**（8–20px，默认 12px）
- **图例文字**（8–20px，默认 12px）
- **悬浮提示**（8–20px，默认 12px）

### 6. 坐标轴刻度间隔

展开"坐标轴刻度间隔"折叠面板，精细控制：

- **X 轴最小刻度间隔**（`ticks.stepSize`）：留空为 Chart.js 自动计算
- **Y 轴最小刻度间隔**：留空为自动，手动设置如 `5` 表示每 5% 绘制一个刻度

### 7. 主题切换

点击右上角"🌓 切换主题"按钮，在**浅色主题**与**暗色主题**之间切换：

- 浅色模式：白色背景，适合打印与白天使用
- 暗色模式：深色背景，适合夜间使用与投影演示

主题偏好自动保存至 localStorage。

### 8. 导出功能

#### 图片导出

- **导出 PNG**：生成高清位图（适合插入 PPT、Word）
- **导出 SVG**：生成矢量图（适合论文排版、缩放不失真）

#### 配置导出/导入

- **导出配置 JSON**：将所有曲线数据、图表设置、字体大小等保存为 `.json` 文件
  - 用途：备份数据、跨设备同步、分享配置给他人
  - 文件名示例：`power_efficiency_config_20240101_123045.json`

- **导入配置 JSON**：点击"📂 导入配置 JSON"按钮，选择之前导出的文件，一键恢复所有设置
  - ⚠️ **注意**：导入会**完全覆盖**当前所有曲线与配置，请先导出备份当前数据

#### 自动保存与恢复

- **自动保存**：每次修改数据或设置时，工具会自动将配置保存到浏览器的 localStorage
- **恢复上次配置**：点击"🔄 恢复上次配置"按钮，加载上次自动保存的状态
- **数据持久性**：关闭浏览器或刷新页面后，数据不会丢失（除非手动清除浏览器缓存）

---

## 🌐 部署与分享

### GitHub Pages 部署

1. 将代码推送到 GitHub 仓库
2. 进入仓库设置（Settings） → Pages
3. 配置如下：
   - **Source**：Deploy from a branch
   - **Branch**：`main`（或 `master`）
   - **Folder**：`/ (root)`
4. 点击 Save，等待几分钟后访问生成的 URL（如 `https://username.github.io/repo-name/`）

### 其他部署方式

- **Netlify/Vercel**：拖拽 `index.html` 到部署页面即可
- **自托管服务器**：将文件上传至 Web 服务器根目录或子目录
- **本地网络共享**：通过局域网共享文件夹，团队成员可直接打开

### 分享建议

- 直接发送 `index.html` 文件（接收者双击即可使用）
- 导出配置 JSON 文件与 `index.html` 一起发送（接收者导入即可查看相同数据）

---

## 🛠️ 技术栈与结构

### 技术栈

- **前端框架**：无框架，纯原生 JavaScript（ES6+）
- **图表库**：[Chart.js v4.4.0](https://www.chartjs.org/)（通过 CDN 加载）
- **样式**：原生 CSS（CSS Variables 实现主题切换）
- **数据存储**：localStorage API

### 文件结构

```
testAI2/
├── index.html          # 主文件（包含所有 HTML/CSS/JavaScript 代码）
├── README.md           # 项目说明文档（本文件）
└── ...                 # 其他项目文档
```

### 架构特点

- **单文件设计**：所有代码（HTML/CSS/JS）内联于 `index.html`，无外部依赖文件
- **无构建步骤**：无需 npm/webpack/vite 等构建工具
- **即时运行**：下载后直接在浏览器中打开

---

## ⚠️ 兼容性与限制

### 浏览器兼容性

| 浏览器 | 最低版本 | 说明 |
|--------|---------|------|
| Chrome | 90+ | 推荐使用 |
| Edge | 90+ | 推荐使用 |
| Firefox | 88+ | 推荐使用 |
| Safari | 14+ | 基本支持 |

### 数据规模建议

- **数据点数量**：建议每条曲线 < 1000 点
- **曲线数量**：最多 5 条曲线（硬限制）
- **超出建议**：数据量过大可能导致渲染卡顿或浏览器内存占用过高

### 已知限制

- localStorage 容量限制约 5–10 MB（因浏览器而异），超出可能导致自动保存失败
- 不支持 IE 浏览器
- 离线使用需提前加载 Chart.js CDN（首次联网访问后会缓存）

---

## ❓ 常见问题（FAQ）

### Q1：粘贴数据后无法解析，表格没有显示？

**可能原因**：

1. 数据格式不正确（每行需包含两个数值）
2. 使用了不支持的分隔符（仅支持空格、制表符、逗号）
3. 小数点格式问题（仅支持 `.`，不支持 `,` 作为小数点）

**解决方法**：

- 检查数据格式，示例正确格式：
  ```
  1.5 95.8
  2.0 96.3
  ```
- 确保每行只有两个数值，中间用空格或逗号分隔
- 删除多余的空行或注释行
- 如果数据来自 Excel，请先粘贴到文本编辑器检查格式

### Q2：图表显示异常，曲线超出范围或刻度不合理？

**可能原因**：

- X/Y 轴最小值或最大值设置不当
- 数据中存在异常值

**解决方法**：

- 清空"X 轴最小值"和"X 轴最大值"输入框，恢复自动缩放
- 清空"Y 轴最小值"和"Y 轴最大值"，或设置为 `0` 和 `100`
- 检查数据表格，删除明显错误的数据点

### Q3：为什么刷新页面后数据消失了？

**可能原因**：

- 浏览器隐私模式/无痕模式下 localStorage 不持久化
- 浏览器缓存被手动清除

**解决方法**：

- 使用正常浏览模式（非隐私模式）
- 养成定期"导出配置 JSON"的习惯，重要数据及时备份
- 使用"恢复上次配置"按钮尝试恢复

### Q4：导出的 PNG 图片分辨率太低？

**说明**：

导出的 PNG 分辨率基于当前浏览器窗口的图表渲染尺寸。

**建议**：

- 在导出前将浏览器窗口最大化
- 可以通过浏览器缩放功能（Ctrl + 滚轮）调整页面缩放比例
- 如需矢量图，使用"导出 SVG"功能（可在 AI/Inkscape 中进一步编辑）

### Q5：如何批量删除曲线或重置所有数据？

**方法**：

- **删除单条曲线**：展开曲线面板，点击"删除曲线"按钮
- **清空所有数据**：刷新浏览器页面（F5），然后在确认弹窗中选择"不恢复"
- **彻底重置**：
  1. 按 F12 打开开发者工具
  2. 切换到 Console（控制台）标签
  3. 输入 `localStorage.clear()` 并回车
  4. 刷新页面

### Q6：最大效率点标记位置不对？

**检查项**：

- 确认"标记最大效率点"复选框已勾选
- 检查数据表格中的效率值是否正确（可能存在输入错误）
- 如果有多个并列最大效率值，工具会自动选择功率最小的点（这是符合工程实践的默认行为）

---

## 📄 许可与致谢

### 许可证

本项目未显式声明许可证，默认保留所有权利。如需商业使用或二次分发，请联系项目维护者。

### 致谢

- 图表库：[Chart.js](https://www.chartjs.org/) - 开源的 HTML5 图表库（MIT 许可证）
- 字体：系统默认字体（苹方、微软雅黑、Segoe UI 等）

---

## 📧 反馈与贡献

如果您在使用过程中遇到问题或有改进建议，欢迎：

- 提交 Issue（如果仓库已启用）
- 发送邮件至项目维护者
- 提交 Pull Request（功能增强或 Bug 修复）

---

## 📝 更新日志

查看项目根目录中的 `CHANGELOG_OPTIMIZATION2.md` 和 `CHANGES.md` 文件了解最近更新。

---

**最后更新**：2024 年 11 月

**版本**：v1.0

**关键词**：功率效率曲线、Chart.js、数据可视化、DC-DC 转换器、电力电子、单文件工具
