# 更新日志 - 优化2

## 版本信息
- 更新时间：2024年
- 分支：feat-max-point-shape-size-fonts-axis-step-collapse-panels
- 更新类型：功能增强

## 新增功能

### 1. 最大效率点标记可配置 ⭐

**位置**：全局设置 → 标记最大效率点选项下方

**功能说明**：
- 新增"最大点形状"下拉选择框，支持6种形状：
  - 圆形（circle）- 默认
  - 三角形（triangle）
  - 矩形（rect）
  - 旋转矩形（rectRot）
  - 星形（star）
  - 十字（cross）
  
- 新增"最大点大小"数值输入框：
  - 范围：3-10 像素
  - 默认值：6 像素
  - 支持整数步进

**技术特性**：
- 标记无边框，视觉更简洁
- 颜色自动跟随所属曲线
- 配置即时生效
- 支持导出/导入

**使用场景**：
- 不同项目可能需要不同的视觉标识
- 当多条曲线颜色接近时，可通过形状区分
- 打印或黑白输出时，形状区分更明显

---

### 2. 字体大小独立配置 📝

**位置**：全局设置 → 字体大小设置（折叠面板）

**功能说明**：
提供5个独立的字体大小配置项：

| 配置项 | 默认值 | 范围 | 影响范围 |
|--------|--------|------|----------|
| 图表主标题 | 18px | 8-32px | 图表顶部主标题 |
| 轴标题 | 14px | 8-24px | X轴和Y轴标题 |
| 轴刻度值 | 12px | 8-20px | X轴和Y轴的数值刻度 |
| 图例文字 | 12px | 8-20px | 图例中的曲线名称 |
| 提示文字 | 12px | 8-20px | 鼠标悬停时的提示框 |

**技术特性**：
- 所有字体大小独立控制
- 实时预览效果
- HTML5输入框限制确保合理范围
- 完整支持持久化（localStorage + JSON导出）

**使用场景**：
- 演示或投影时需要放大字体
- 打印输出时需要精确控制字体
- 高分辨率显示器需要调整字体
- 不同用户的视觉偏好

---

### 3. 坐标轴刻度间隔配置 📏

**位置**：全局设置 → 坐标轴刻度间隔（折叠面板）

**功能说明**：
- 新增"X轴最小刻度间隔"输入框
- 新增"Y轴最小刻度间隔"输入框
- 支持小数输入（如0.5、2.5等）
- 留空时自动计算最优刻度

**技术特性**：
- 基于Chart.js的ticks.stepSize属性
- 即时应用，无需刷新
- 支持清空恢复自动模式
- 配置可保存和导出

**使用场景**：
- 数据密度高时，设置较大间隔避免拥挤
- 需要特定刻度（如每5、每10）以便读取
- 对齐多个图表的刻度间隔
- 满足特定行业的图表规范

**示例**：
```
X轴最小刻度间隔：10  → X轴显示 0, 10, 20, 30...
Y轴最小刻度间隔：5   → Y轴显示 0, 5, 10, 15...
留空                → 自动计算最优间隔
```

---

### 4. 曲线数据一键折叠 📁

**位置**：曲线数据管理 → 顶部按钮组

**功能说明**：
- 新增"📁 折叠全部"按钮
- 点击后折叠所有曲线的所有折叠区块
- 按钮文字自动切换为"📂 展开全部"
- 再次点击展开所有折叠区块

**技术特性**：
- 智能检测当前状态
- 影响所有曲线的：批量粘贴、逐点添加、数据表
- 按钮文字动态更新
- 不影响数据内容

**使用场景**：
- 快速折叠以专注于图表分析
- 管理多条曲线时提高操作效率
- 演示时快速展开所有数据
- 截图前整理界面

---

## 兼容性说明

### ✅ 完全兼容现有功能
- 导出PNG/SVG图片
- 导出/导入JSON配置
- 多曲线管理（最多5条）
- 主题切换（明暗模式）
- 数据批量粘贴/逐点添加
- 最大效率汇总表
- 数据表高亮显示
- 参考线功能
- 平滑曲线、区域填充等选项

### 📦 配置文件兼容性
- **新版读取旧版配置**：新增字段使用默认值
- **旧版读取新版配置**：忽略未知字段，基础功能正常

### 🔄 localStorage自动保存
所有新增配置项均已纳入自动保存机制，刷新页面后自动恢复：
- ✅ 最大点形状和大小
- ✅ 所有字体大小设置
- ✅ X/Y轴刻度间隔

---

## 使用建议

### 最佳实践

1. **字体大小调整顺序**：
   - 先调整主标题（最显眼）
   - 再调整轴标题和图例（次要）
   - 最后微调刻度值和提示框

2. **最大点标记选择**：
   - 单曲线：推荐圆形（简洁）
   - 多曲线同色系：推荐不同形状
   - 黑白打印：推荐星形或十字（区分度高）

3. **刻度间隔设置**：
   - 优先使用自动模式
   - 数据范围大（如0-1000）：设置较大间隔（如50、100）
   - 数据范围小（如90-100）：使用小间隔（如1、2）

4. **一键折叠使用**：
   - 数据录入完成后，折叠所有面板专注分析
   - 需要修改数据时，展开全部快速定位
   - 演示时根据需要切换展开/折叠状态

### 常见问题

**Q1：为什么修改字体后图表有点变形？**  
A：字体变大后可能导致标签重叠，建议同时调整图表大小或减小字体。

**Q2：刻度间隔设置为什么不生效？**  
A：请确认输入的是数字（支持小数），留空才是自动模式。

**Q3：一键折叠会删除数据吗？**  
A：不会！一键折叠只是隐藏/显示UI面板，不影响任何数据。

**Q4：最大点标记可以对不同曲线设置不同形状吗？**  
A：当前版本不支持，所有曲线使用相同形状，但颜色自动跟随曲线。

---

## 更新统计

- 新增HTML代码：172行
- 新增JavaScript函数：1个（toggleAllCurvePanels）
- 修改JavaScript函数：3个（initChart、updateChart、getCurrentConfiguration、loadConfiguration）
- 新增配置项：9个
- 新增UI控件：13个

---

## 相关文档

- [测试清单](./TEST_NEW_FEATURES.md)
- [实施总结](./OPTIMIZATION_2_SUMMARY.md)
- [原项目说明](./README_CHANGES.md)

---

## 反馈与建议

如有任何问题或建议，请通过以下方式反馈：
- 提交GitHub Issue
- 联系项目维护者

**感谢使用功率-效率曲线分析工具！** 🎉
